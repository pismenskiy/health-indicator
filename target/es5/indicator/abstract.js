function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}import Health from"../health";import{OK}from"../endpoint/statuses";import{mapValues,find,minBy,maxBy,toArray,isEmpty,isDefined,pickBy}from"../base";export var UNKNOWN="UNKNOWN";export var DEFAULT_CRITICAL=!1;export var DEFAULT_STATUS="UNKNOWN";export var DEFAULT_HTTP_CODE=OK;export var SEVERITY_ORDER=["UNKNOWN"];export var HTTP_MAP=_defineProperty({},"UNKNOWN",DEFAULT_HTTP_CODE);var AbstractIndicator=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=b.critical,d=b.status,e=b.deps,f=b.extra;if(_classCallCheck(this,a),_defineProperty(this,"status",void 0),_defineProperty(this,"critical",void 0),_defineProperty(this,"deps",void 0),_defineProperty(this,"extra",void 0),this.constructor===a)throw new Error("Abstract cannot be instantiated");return this.status=d,this.critical=c,this.deps=e,this.extra=f,this}return _createClass(a,[{key:"health",value:function health(){var a=this.getStatus(),b=this.getCritical(),c=mapValues(this.getDeps(),function(a){return a.health()}),d=this.getExtra();return new Health({status:a,critical:b,deps:c,extra:d})}},{key:"getStatus",value:function getStatus(){return this.status?this.status:this.constructor.resolveStatusFromDeps(this.getDeps(),this.constructor.getSeverityOrder(),this.constructor.getDefaultStatus())}},{key:"getCritical",value:function getCritical(){return isDefined(this.critical)?!!this.critical:this.constructor.resolveCriticalFromDeps(this.getDeps(),this.constructor.getDefaultCritical())}},{key:"getDeps",value:function getDeps(){return this.deps}},{key:"getExtra",value:function getExtra(){return this.extra}}],[{key:"getDefaultStatus",value:function getDefaultStatus(){return DEFAULT_STATUS}},{key:"getDefaultCritical",value:function getDefaultCritical(){return DEFAULT_CRITICAL}},{key:"getSeverityOrder",value:function getSeverityOrder(){return SEVERITY_ORDER}},{key:"getStatusMap",value:function getStatusMap(){return{UNKNOWN:UNKNOWN}}},{key:"getHttpMap",value:function getHttpMap(){return HTTP_MAP}},{key:"getDefaultHttpCode",value:function getDefaultHttpCode(){return DEFAULT_HTTP_CODE}},{key:"getHttpCode",value:function getHttpCode(a){var b=this.getHttpMap(),c=this.getDefaultHttpCode(),d=b[a];return d||c}},{key:"resolveCriticalFromDeps",value:function resolveCriticalFromDeps(a,b){return void 0===a||null===a||isEmpty(a)?!!b:!!find(a,function(a){return a.health().critical})}},{key:"resolveStatusFromDeps",value:function resolveStatusFromDeps(a,b,c){if(void 0===a||null===a||isEmpty(a))return""+c;var d=pickBy(a,function(a){return a.health().critical});return isEmpty(d)?this.getHighestStatus(a,b):this.getLowestStatus(d,b)}},{key:"getLowestStatus",value:function getLowestStatus(a,b){var c=toArray(a),d=b||this.getSeverityOrder();return minBy(c,function(a){var b=d.indexOf(a.health().status);return-1===b?1/0:b}).health().status}},{key:"getHighestStatus",value:function getHighestStatus(a,b){var c=toArray(a),d=b||this.getSeverityOrder();return maxBy(c,function(a){var b=d.indexOf(a.health().status);return-1===b?-Infinity:b}).health().status}}]),a}();export{AbstractIndicator as default};